<div class="container mt-4">
  <div class="mb-4">
    <h3 class="fw-bold text-dark">Registrar Ponto</h3>
    <p class="text-muted">Gestão de jornada de trabalho</p>
  </div>

  <div class="row g-4">
    
    <div class="col-md-5 col-lg-4">
      <div class="card border-0 shadow-sm h-100 p-3 text-center d-flex flex-column justify-content-center align-items-center">
        
        <div *ngIf="showWarningMessage" class="alert alert-danger w-100 d-flex align-items-center mb-3" role="alert">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          <div>{{ warningText }}</div>
        </div>

        <div *ngIf="showSuccessMessage" class="alert alert-success w-100 d-flex align-items-center mb-3" role="alert">
          <i class="bi bi-check-circle-fill me-2"></i>
          <div>Ponto registrado com sucesso!</div>
        </div>

        <ng-container *ngIf="!isCameraOpen">
          <div class="clock-display mb-3">
            {{ currentTime | date:'HH:mm:ss' }}
          </div>

          <button 
            class="btn btn-primary btn-lg w-100 py-3 rounded-pill fw-bold shadow-sm mb-4 d-flex align-items-center justify-content-center gap-2"
            (click)="openCamera()"
            [disabled]="isLoading">
            
            <i class="bi bi-fingerprint fs-4"></i>
            <span>Registrar Ponto</span>
          </button>

          <div class="bg-light px-3 py-2 rounded-pill text-muted small d-inline-flex align-items-center gap-2 border">
            <i class="bi bi-geo-alt-fill"></i>
            Local: IP {{ userIp }}
          </div>
        </ng-container>

        <ng-container *ngIf="isCameraOpen">
          <div class="webcam-container mb-3 border rounded overflow-hidden position-relative bg-black" style="width: 100%; height: 280px;">
            
            <webcam 
                [trigger]="triggerObservable" 
                (imageCapture)="handleImage($event)"
                [width]="350" [height]="280"
                [videoOptions]="videoOptions" 
                class="w-100 h-100"
                style="object-fit: cover;">
            </webcam>

            <div *ngIf="isLoading" class="position-absolute top-0 start-0 w-100 h-100 d-flex flex-column align-items-center justify-content-center bg-dark bg-opacity-75 text-white">
              <div class="spinner-border mb-2" role="status"></div>
              <span>Validando biometria...</span>
            </div>
          </div>

          <div class="d-grid gap-2 w-100">
            <button class="btn btn-success py-2 fw-bold" (click)="triggerSnapshot()" [disabled]="isLoading">
              <i class="bi bi-camera-fill me-2"></i> Capturar
            </button>
            <button class="btn btn-outline-secondary py-2" (click)="closeCamera()" [disabled]="isLoading">
              Cancelar
            </button>
          </div>
        </ng-container>

      </div>
    </div>

    <div class="col-md-7 col-lg-8">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-white border-0 pt-3 pb-0">
          <h5 class="fw-bold text-muted">
            <i class="bi bi-list-ul me-2"></i>Histórico de Hoje
          </h5>
        </div>
        <div class="card-body">
          <div class="timeline">
            
            <div *ngFor="let item of history; let last = last" class="timeline-item d-flex pb-4 position-relative animate__animated animate__fadeInLeft">
              <div class="timeline-line" *ngIf="!last"></div>
              <div class="me-3">
                <div class="timeline-icon rounded-circle d-flex align-items-center justify-content-center border bg-white" 
                     [ngClass]="item.colorClass">
                  <i class="bi {{ item.icon }}"></i>
                </div>
              </div>
              <div class="flex-grow-1 d-flex justify-content-between align-items-start">
                <div>
                  <h6 class="mb-0 fw-bold" [ngClass]="item.colorClass.replace('border-', '')">
                    {{ item.type }}
                  </h6>
                  <small class="text-muted">{{ item.method }}</small>
                </div>
                <div class="fw-bold fs-5 text-dark">
                  {{ item.time }}
                </div>
              </div>
            </div>

            <div *ngIf="history.length === 0" class="text-center text-muted py-5 d-flex flex-column align-items-center">
              <i class="bi bi-clock-history fs-1 mb-2 opacity-50"></i>
              <p>Nenhum ponto registrado hoje.</p>
            </div>

          </div>
        </div>
      </div>
    </div>

  </div>
</div>